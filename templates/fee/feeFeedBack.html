<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê´€ë¦¬ë¹„ ë§¤ë‹ˆì € | A.P.T</title>

<!-- Sidebar CSS -->
<link rel="stylesheet" href="/css/sidebar.css">

<!-- Pretendard Font -->
<link rel="stylesheet" th:href="@{/css/font.css}" />

<!-- Favicon -->
<link rel="icon" href="/icons/favicon.png" type="image/png">

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
	font-family: 'Pretendard', sans-serif;
	background-color: #FDFDFD;
	color: #1e1e1e;
	margin: 0;
	padding: 0;
	width: 100vw;
	overflow-x: hidden;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
	height: 100%;
	align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
}

/* ì²« ë²ˆì§¸ ì„¹ì…˜ */
#main {
	width: 60%;
}

#chart_box {
	background: white;
	border-radius: 12px;
	padding: 1rem;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	margin-bottom: 2rem;
}

#summary {
	background: #fff;
	padding: 2rem;
	border-radius: 20px;
	box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
	display: flex;
	justify-content: space-between;
	align-items: center;
	gap: 2rem;
	flex-wrap: wrap;
	font-size: 1rem;
	line-height: 1.6;
	color: #444;
	margin-bottom: 8%;
}

.summary-left-wrapper {
	flex: 1;
	font-size: 1.3rem;
	font-weight: 700;
	color: #292929;
	margin-left: 15%;
}

.summary-left-wrapper .highlight {
	color: #ff4c4c;
	font-weight: bold;
	font-size: 1.4rem;
}

.summary-right-wrapper {
	flex: 1;
	text-align: right;
	font-size: 1.05rem;
	color: #292929;
	margin-right: 20%;
}

.summary-right-wrapper p {
	margin: 0.4rem 0;
}

.summary-right-wrapper span {
	color: #292929;
	font-weight: 500;
}

@media ( max-width : 600px) {
	#summary {
		flex-direction: column;
		text-align: left;
	}
	.summary-right-wrapper {
		text-align: left;
		margin-top: 1rem;
	}
}

#summary strong {
	font-weight: bold;
	font-size: 1.2rem;
}

/* ë‘ ë²ˆì§¸ ì„¹ì…˜ */
.central-wrap {
	flex-grow: 1;
	display: flex;
	flex-direction: column;
	align-items: center;
	box-sizing: border-box;
	padding-top: 30px;
	padding-bottom: 30px;
}

.container {
	width: 100%;
	max-width: 1400px;
	min-width: 700px;
	display: flex;
	flex-direction: column;
	align-items: center;
	box-sizing: border-box;
	margin-bottom: 60px;
}

.page-title {
	font-size: 36px;
	font-weight: 800;
	margin-bottom: 60px;
	color: #292929;
	width: 100%;
	text-align: left;
	padding-top: 80px;
	padding-left: 35%;
}

.dashboard {
	width: 100%;
	display: flex;
	flex-direction: row;
	gap: 0;
	margin-bottom: 20px;
	margin-right: 100px;
	box-sizing: border-box;
	position: relative;
}

.card {
	background: none !important;
	border: none !important;
	box-shadow: none !important;
	border-radius: 0 !important;
	padding: 32px 32px 32px 32px;
	flex: 1 1 0;
	min-width: 0;
	max-width: 100%;
	min-height: 540px;
	display: flex;
	flex-direction: column;
	position: relative;
}

.card-contents {
	flex: 1;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	width: 96%;
	max-width: 100%;
	box-sizing: border-box;
	margin: 0 auto;
}

.section-title {
	font-size: 26px;
	font-weight: 700;
	margin-bottom: 8px;
	color: #292929;
	width: auto;
	text-align: left;
	position: absolute;
	top: 32px;
	left: 32px;
	z-index: 2;
	letter-spacing: -1px;
}

.info-text, .usage-total {
	color: #8c8c8c;
	font-size: 20px;
	margin-bottom: 0;
	width: auto;
	text-align: left;
	position: absolute;
	top: 72px;
	left: 32px;
	z-index: 2;
	font-weight: 600;
}

.highlight-red {
	color: #FF6B6B;
	font-weight: 700;
}

.highlight-blue {
	color: #4E7CFF;
	font-weight: 700;
}

.gauge-container {
	position: relative;
	width: 350px;
	height: 180px;
	margin: 0 auto 40px auto;
}

#gaugeCenterText {
	position: absolute;
	top: 70%;
	left: 50%;
	transform: translate(-50%, -30%);
	text-align: center;
	line-height: 1.2;
	width: 100%;
}

.gauge-label {
	font-size: 20px;
	color: #8c8c8c;
	font-weight: 500;
}

.gauge-value {
	font-size: 34px;
	font-weight: 800;
	color: #292929;
	margin-top: 4px;
}

.value-grid {
	display: flex;
	justify-content: space-between;
	width: 350px;
	margin: 0 auto;
}

.value-item {
	text-align: center;
}

.value-label {
	font-size: 18px;
	color: #8c8c8c;
	font-weight: 600;
	margin-bottom: 8px;
}

.value-amount {
	font-size: 24px;
	font-weight: 700;
	color: #292929;
}

.bar-wrapper {
	height: 18px;
	background: #f0f0f0;
	border-radius: 12px;
	overflow: hidden;
	margin-bottom: 40px;
	width: 600px;
	margin-left: auto;
	margin-right: auto;
}

.bar-electricity {
	background: #FFD84E;
	height: 100%;
	width: 72.1%;
	float: left;
}

.bar-water {
	background: #4E7CFF;
	height: 100%;
	width: 27.9%;
	float: left;
}

.usage-details {
	display: flex;
	flex-direction: column;
	gap: 28px;
	width: 600px;
	margin-left: auto;
	margin-right: auto;
}

.usage-item {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.usage-left {
	display: flex;
	align-items: center;
	gap: 14px;
}

.usage-icon {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 16px;
	max-width: 100%;
}

.icon-electric {
	background: #FFD84E;
}

.icon-water {
	background: #4E7CFF;
}

.usage-info {
	display: flex;
	flex-direction: column;
	max-width: 100%;
	box-sizing: border-box;
}

.usage-name {
	font-size: 20px;
	font-weight: 600;
	color: #292929;
	margin-bottom: 2px;
}

.usage-amount {
	font-size: 22px;
	font-weight: 700;
	color: #292929;
}

.ai-suggestion {
	background: #fff;
	border-radius: 24px;
	padding: 56px 32px 56px 56px; /* ì™¼ìª½ íŒ¨ë”©ì„ 56pxë¡œ ìœ ì§€ (ì›í•˜ì‹ ë‹¤ë©´ ë” ëŠ˜ë¦´ ìˆ˜ ìˆìŒ) */
	max-height: 250px;
	box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
	display: flex;
	gap: 32px; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© (í•„ìš”ì‹œ ì¤„ì¼ ìˆ˜ ìˆìŒ) */
	width: 100%;
	max-width: 1400px;
	box-sizing: border-box;
}

/* ìƒˆë¡œìš´ ì•„ì´ì½˜ ë˜í¼ ìŠ¤íƒ€ì¼ */
.ai-icon-wrapper {
	display: flex;
	align-items: center; /* ì´ ë¶€ë¶„ì´ ì•„ì´ì½˜ì„ ì„¸ë¡œ ì¤‘ì•™ì— ì •ë ¬í•©ë‹ˆë‹¤. */
	flex-shrink: 0; /* ì•„ì´ì½˜ ë˜í¼ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. */
	/* ai-suggestionì˜ ì „ì²´ ë†’ì´ì— ë§ì¶° ì•„ì´ì½˜ ë˜í¼ê°€ ëŠ˜ì–´ë‚˜ë„ë¡ í•˜ë ¤ë©´ í•„ìš”ì‹œ height: 100%; ì¶”ê°€ */
}

.ai-icon {
	width: 90px;
	height: 90px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 36px;
	flex-shrink: 0;
	/* margin-bottom: 10%; ì´ ë¶€ë¶„ ì œê±° */
}

.ai-icon img {
	width: 100px;
	height: 100px;
	padding-left: 100px;
	/* padding-right: 80px; */
}

/* ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ ë˜í¼ ìŠ¤íƒ€ì¼ */
.ai-text-wrapper {
	/* í…ìŠ¤íŠ¸ëŠ” ê¸°ë³¸ ì •ë ¬ (Flexboxì˜ flex-start)ì„ ìœ ì§€í•©ë‹ˆë‹¤. */
	display: flex; /* í…ìŠ¤íŠ¸ ë‚´ìš©ì´ ì—¬ëŸ¬ ì¤„ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ flex ì‚¬ìš© */
	flex-direction: column; /* í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì„¸ë¡œë¡œ ìŒ“ìŠµë‹ˆë‹¤. */
	justify-content: center; /* í…ìŠ¤íŠ¸ë¥¼ ìƒë‹¨ì— ì •ë ¬í•©ë‹ˆë‹¤. */
	align-items: flex-start;
	flex-grow: 1; /* ë‚¨ì€ ê³µê°„ì„ í…ìŠ¤íŠ¸ ë˜í¼ê°€ ì±„ìš°ë„ë¡ í•©ë‹ˆë‹¤. */
	flex-shrink: 0; /* ì´ ë¶€ë¶„ì´ ì¤‘ìš”í•©ë‹ˆë‹¤: ê³µê°„ì´ ë¶€ì¡±í•´ë„ í…ìŠ¤íŠ¸ ë˜í¼ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. */
	min-width: 0; /* Flexbox ì•„ì´í…œì˜ ê¸°ë³¸ ë™ì‘ì„ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ë‚´ìš©ì´ ë„˜ì¹  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. */
}

.ai-text {
	font-size: 26px;
	line-height: 1.8;
	color: #292929;
	/* padding-left: 5%; */
	white-space: nowrap;
	margin-left: 10%;
}

.ai-text strong {
	font-weight: 700;
}

/* ì¹´ë“œ ì‚¬ì´ ì„¸ë¡œ êµ¬ë¶„ì„  */
.dashboard .card:not(:last-child) {
	margin-right: 28px;
	position: relative;
}

.dashboard .card:not(:last-child)::after {
	content: "";
	position: absolute;
	top: 38px;
	right: -14px;
	width: 1.5px;
	height: calc(100% - 76px);
	background: #e1e1e1;
	border-radius: 3px;
	z-index: 3;
}

@media ( max-width : 1200px) {
	.container, .ai-suggestion {
		max-width: 98vw;
		min-width: 0;
	}
	.gauge-container, .value-grid, .bar-wrapper, .usage-details {
		width: 220px !important;
		min-width: 0;
	}
}

@media ( max-width : 900px) {
	.dashboard {
		flex-direction: column;
		gap: 32px;
	}
	.card {
		min-height: 420px;
	}
	.dashboard .card:not(:last-child)::after {
		display: none;
	}
}

.compare-page-btn {
	border-radius: 40px;
	position: absolute;
	background-color: #fff;
	border: 2px solid #FF9E96;
	width: 140px;
	height: 40px;
	display: flex; /* flexbox ì‚¬ìš© */
	justify-content: center; /* ê°€ë¡œë¡œ ê°€ìš´ë° ì •ë ¬ */
	align-items: center; /* ì„¸ë¡œë¡œ ê°€ìš´ë° ì •ë ¬ */
	font-size: 20px;
	font-weight: 600;
	color: #FF9E96;
	top: 120px;
	right: 380px;
	box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
	transition: background-color 0.3s ease;
}

.compare-page-btn:hover {
	color: #fff;
	background-color: #FF9E96;
	border: 2px solid #FF9E96;
}

/* footer */
footer {
	background-color: #f2f2f2;
	padding: 15px 0;
	text-align: center;
	font-size: 14px;
	color: #666;
	width: 100%;
	flex-shrink: 0;
}
</style>
</head>

<body>
	<div th:replace="common/sidebar :: sidebar"></div>
	<div class="page-title">ê´€ë¦¬ë¹„ ë§¤ë‹ˆì €</div>

	<a th:href="@{feeCompare}"><div class="compare-page-btn">ë¹„êµí•´ë³´ê¸°</div></a>

	<div id="main">
		<div id="chart_box">
			<canvas id="managerChart"></canvas>
		</div>
		<div id="summary">
			<div class="summary-left-wrapper">
				<strong>âœ¨ ì „ì›” ëŒ€ë¹„ <span class="highlight">1,980ì›</span> ì ˆì•½!
				</strong>
			</div>
			<div class="summary-right-wrapper">
				<p>
					ì´ë²ˆ ë‹¬ ì ˆì•½: <span>ì»¤í”¼ í•œ ì”</span>
				</p>
			</div>
		</div>
	</div>

	<div class="central-wrap">
		<div class="container">
			<div class="dashboard">
				<div class="card">
					<div class="section-title">ë‚˜ì˜ ì—ë„ˆì§€ ì†Œë¹„í˜„í™©</div>
					<div class="info-text" id="monthlyDiff"></div>
					<div class="card-contents">
						<div class="gauge-container">
							<canvas id="gaugeChart" width="350" height="180"></canvas>
							<div id="gaugeCenterText">
								<div class="gauge-label">ì „ì›” ëŒ€ë¹„</div>
								<div class="gauge-value" id="gaugeValueText"></div>
							</div>
						</div>
						<div class="value-grid" style="width: 350px">
							<div class="value-item">
								<div class="value-label">ì „ì›” ê¸ˆì•¡</div>
								<div class="value-amount" id="prevAmount"></div>
							</div>
							<div class="value-item">
								<div class="value-label">ì´ë²ˆë‹¬ ê¸ˆì•¡</div>
								<div class="value-amount" id="thisAmount"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="section-title">ë‚˜ì˜ ì—ë„ˆì§€ ì‚¬ìš©í˜„í™©</div>
					<div class="usage-total" id="monthlyTotal"></div>
					<div class="card-contents">
						<div class="bar-wrapper" id="usageBarWrapper">
							<div class="bar-electricity" id="barElectricity"></div>
							<div class="bar-water" id="barWater"></div>
						</div>
						<div class="usage-details">
							<div class="usage-item">
								<div class="usage-left">
									<div class="usage-icon icon-electric">âš¡</div>
									<div class="usage-info">
										<div class="usage-name">ì „ê¸°ìš”ê¸ˆ</div>
										<div class="usage-unit" id="elecUsageUnit"></div>
									</div>
								</div>
								<div class="usage-amount" id="elecUsageAmount"></div>
							</div>
							<div class="usage-item">
								<div class="usage-left">
									<div class="usage-icon icon-water">ğŸ’§</div>
									<div class="usage-info">
										<div class="usage-name">ìˆ˜ë„ìš”ê¸ˆ</div>
										<div class="usage-unit" id="waterUsageUnit"></div>
									</div>
								</div>
								<div class="usage-amount" id="waterUsageAmount"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="ai-suggestion">
				<div class="ai-icon-wrapper">
					<div class="ai-icon">
						<img src="/icons/feedback.png">
					</div>
				</div>
				<div class="ai-text-wrapper">
					<div class="ai-text">
						<!-- <strong>ì „ê¸° ì‚¬ìš©ëŸ‰ì´ ì €ë²ˆë‹¬ ë³´ë‹¤ 30% ë§ë„¤ìš”.</strong><br> ì—ì–´ì»¨ì„ ìì£¼ ì¼œë‘ì…¨ë‚˜ìš”? -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<footer>
		<div>
			<p style="margin: 0;">Â© 2025 A.P.T. All rights reserved.</p>
			<p style="margin: 5px 0 0;">
				Made with <span class="computer-icon">ğŸ’»</span> by íŒ€ EF
			</p>
		</div>
	</footer>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script th:inline="javascript">
	    const rawData = /*[[${chartData}]]*/ [];
	    console.log("ğŸ”¥ rawData", rawData);
	    
	    // --- (1) managerChart (ë¼ì¸ ê·¸ë˜í”„) ---
	    const labels = rawData.map(item => `${item.feeMonth}ì›”`);
	    const userData = rawData.map(item => item.userFee);
	    const avgData = rawData.map(item => item.aptAvgFee);
	    
	    const managerChartCtx = document.getElementById('managerChart').getContext('2d');
	    new Chart(managerChartCtx, {
	        type: 'line',
	        data: {
	            labels: labels,
	            datasets: [
	                {
	                    label: 'ìš°ë¦¬ì§‘',
	                    data: userData,
	                    borderColor: '#ff6384',
	                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
	                    fill: false,
	                    tension: 0.3,
	                    borderWidth: 3,
	                    pointRadius: 5,
	                    pointBackgroundColor: '#ff6384'
	                },
	                {
	                    label: 'ì•„íŒŒíŠ¸ í‰ê· ',
	                    data: avgData,
	                    borderColor: '#c7c7c7',
	                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
	                    fill: false,
	                    tension: 0.3,
	                    borderWidth: 3,
	                    pointRadius: 5,
	                    pointBackgroundColor: '#c7c7c7'
	                }
	            ]
	        },
	        options: {
	            responsive: true,
	            plugins: {
	                legend: {
	                    display: true,
	                    position: 'top',
	                    labels: {
	                        usePointStyle: true,
	                        padding: 20,
	                        font: {
	                            size: 14
	                        }
	                    }
	                }
	            },
	            scales: {
	                y: {
	                    beginAtZero: true,
	                    ticks: {
	                        stepSize: 50000
	                    }
	                }
	            }
	        }
	    });
	    
	    // --- (2) ë°ì´í„° ê°œìˆ˜ì— ë”°ë¥¸ ëª¨ë“  ì¡°ê±´ë¶€ ë¡œì§ ì‹œì‘ ---
	    // ì´ í•˜ë‚˜ì˜ if/else ë¸”ë¡ì—ì„œ ëª¨ë“  ë™ì  UIë¥¼ ì²˜ë¦¬.
	    if (rawData && rawData.length >= 2) { 
	        // latestDataì™€ previousDataëŠ” ì´ ë¸”ë¡ ì•ˆì—ì„œë§Œ ì„ ì–¸
	        const latestData = rawData[rawData.length - 1]; 
	        const previousData = rawData[rawData.length - 2]; 

	        // --- 2-1. ì „ì›” ëŒ€ë¹„ ì ˆì•½ ê¸ˆì•¡ ê³„ì‚° ë° í‘œì‹œ (ì²« ë²ˆì§¸ ì„¹ì…˜) ---
	        const latestUserFee = latestData.userFee;
	        const previousUserFee = previousData.userFee;
	        const savings = previousUserFee - latestUserFee; 

	        const summaryHighlightSpan = document.querySelector('.summary-left-wrapper .highlight');
	        const coffeeSavingsSpan = document.querySelector('.summary-right-wrapper span');

	        if (summaryHighlightSpan) {
	            summaryHighlightSpan.textContent = savings.toLocaleString() + 'ì›';
	        }

	        if (coffeeSavingsSpan) {
	            if (savings >= 30000) { coffeeSavingsSpan.textContent = 'ë§›ìˆëŠ” ì¹˜í‚¨ í•œ ë§ˆë¦¬! ğŸ—'; } 
	            else if (savings >= 28000) { coffeeSavingsSpan.textContent = 'ë°°ë‹¬ë¹„ í¬í•¨ ë“ ë“ í•œ ì•¼ì‹ ì„¸íŠ¸! ğŸœ'; } 
	            else if (savings >= 26000) { coffeeSavingsSpan.textContent = 'ì˜í™” ê´€ëŒê¶Œ ë‘ ì¥! ğŸ¬ğŸ¬'; } 
	            else if (savings >= 24000) { coffeeSavingsSpan.textContent = 'ìœ ëª… ë¸Œëœë“œ ë²„ê±° ì„¸íŠ¸ ë‘ ê°œ! ğŸ”ğŸ”'; } 
	            else if (savings >= 22000) { coffeeSavingsSpan.textContent = 'ë§ˆì‚¬ì§€ìƒµ 10ë¶„ ì¶”ê°€! ğŸ’†â€â™€ï¸'; } 
	            else if (savings >= 20000) { coffeeSavingsSpan.textContent = 'ë™ë„¤ ë§›ì§‘ ì ì‹¬ íŠ¹ì„ ! ğŸš'; } 
	            else if (savings >= 18000) { coffeeSavingsSpan.textContent = 'í–¥ê¸° ì¢‹ì€ ë””í“¨ì € í•˜ë‚˜! ğŸŒ¿'; } 
	            else if (savings >= 16000) { coffeeSavingsSpan.textContent = 'ìƒˆë¡œìš´ ì·¨ë¯¸ìš©í’ˆ êµ¬ë§¤! ğŸ¨'; } 
	            else if (savings >= 14000) { coffeeSavingsSpan.textContent = 'ì„œì ì—ì„œ ë² ìŠ¤íŠ¸ì…€ëŸ¬ í•œ ê¶Œ! ğŸ“š'; } 
	            else if (savings >= 12000) { coffeeSavingsSpan.textContent = 'í”„ë¦¬ë¯¸ì—„ ì»¤í”¼ ë‘ ì”! â˜•â˜•'; } 
	            else if (savings >= 10030) { coffeeSavingsSpan.textContent = 'ìµœì €ì‹œê¸‰ë§Œí¼ ë²Œì—ˆì–´ìš”! ğŸ’°'; } 
	            else if (savings >= 8000) { coffeeSavingsSpan.textContent = 'ë§›ìˆëŠ” ì¡°ê° ì¼€ì´í¬ í•˜ë‚˜! ğŸ°'; } 
	            else if (savings >= 6000) { coffeeSavingsSpan.textContent = 'í¸ì˜ì  ê°„ì‹ ê¾¸ëŸ¬ë¯¸! ğŸ«'; } 
	            else if (savings >= 4000) { coffeeSavingsSpan.textContent = 'ì‹œì›í•œ ì•„ì´ìŠ¤í¬ë¦¼ í•˜ë‚˜! ğŸ¦'; } 
	            else if (savings >= 2000) { coffeeSavingsSpan.textContent = 'ëŒ€ì¤‘êµí†µ ìš”ê¸ˆ í•œ ë²ˆ! ğŸšŒ'; } 
	            else if (savings > 0) { coffeeSavingsSpan.textContent = 'ì‘ì€ ì ˆì•½ë„ í° í˜ì´ ë¼ìš”! ğŸ’ª'; } 
	            else if (savings === 0) { coffeeSavingsSpan.textContent = 'ì´ë²ˆ ë‹¬ì€ ë˜ì´ë˜ì´! ğŸ˜‰ ë‹¤ìŒ ë‹¬ì—” ë” ë…¸ë ¥í•´ë´ìš”!'; } 
	            else { // ì˜¤íˆë ¤ ë” ì‚¬ìš©í•œ ê²½ìš° (savings < 0)
	                coffeeSavingsSpan.textContent = 'ì´ë²ˆ ë‹¬ì€ ì•„ì‰½ì§€ë§Œ ë‹¤ìŒ ë‹¬ì— í˜ë‚´ë´ìš”! ğŸ˜­';
	                if (summaryHighlightSpan) {
	                     summaryHighlightSpan.closest('strong').innerHTML = 
	                         `<strong>âœ¨ ì „ì›” ëŒ€ë¹„ <span class="highlight-negative">${Math.abs(savings).toLocaleString()}ì›</span> ë” ì‚¬ìš©í–ˆì–´ìš”! ğŸ˜­</strong>`;
	                     summaryHighlightSpan.classList.add('highlight-negative');
	                     summaryHighlightSpan.classList.remove('highlight');
	                }
	            }
	        }
	        
	        // --- 2-2. ì „ê¸°ë£Œ + ìˆ˜ë„ë£Œ í•©ì‚° ë° ê²Œì´ì§€ ì°¨íŠ¸ ë¡œì§ (ë‚˜ì˜ ì—ë„ˆì§€ ì†Œë¹„í˜„í™©) ---
	        const currentElecWaterTotal = (latestData.userElecFee || 0) + (latestData.userWaterFee || 0);
	        const previousElecWaterTotal = (previousData.userElecFee || 0) + (previousData.userWaterFee || 0);

	        let prevAmount = previousElecWaterTotal; // <-- prevAmount _ì •ì˜
	        let thisAmount = currentElecWaterTotal;   // <-- thisAmount ì •ì˜
	        let amountDiff = thisAmount - prevAmount; 
	        let percentDiff = prevAmount > 0 ? Math.round((amountDiff / prevAmount) * 100) : 0; 

	        document.getElementById('prevAmount').innerText = prevAmount.toLocaleString('ko-KR') + 'ì›';
	        document.getElementById('thisAmount').innerText = thisAmount.toLocaleString('ko-KR') + 'ì›';
	        document.getElementById('gaugeValueText').innerText = `${percentDiff > 0 ? '+' : ''}${percentDiff}%`;

	        let diffTextClass = amountDiff > 0 ? 'highlight-red' : (amountDiff < 0 ? 'highlight-blue' : ''); 
	        let diffSign = amountDiff > 0 ? '+' : '';
	        let diffAction = amountDiff >= 0 ? 'ë” ë‚˜ì™”ì–´ìš”.' : 'ëœ ë‚˜ì™”ì–´ìš”.';
	        document.getElementById('monthlyDiff').innerHTML = `ì „ì›” ë³´ë‹¤ <span class="${diffTextClass}">${diffSign}${amountDiff.toLocaleString('ko-KR')}ì›</span> ${diffAction}`;

	        function renderGaugeChart() {
	            const ctx = document.getElementById('gaugeChart').getContext('2d');
	            const gradient = ctx.createLinearGradient(0, 0, 350, 0);
	            
	            if (amountDiff < 0) {
	                gradient.addColorStop(0, '#8BC34A'); gradient.addColorStop(0.5, '#689F38'); gradient.addColorStop(1, '#33691E');
	            } else {
	                gradient.addColorStop(0, '#FF9B98'); gradient.addColorStop(0.5, '#FFA48F'); gradient.addColorStop(1, '#FFBD7C');
	            }

	            if (window.gaugeChartInstance) window.gaugeChartInstance.destroy();

	            let gaugeVal = Math.min(Math.abs(percentDiff), 100);
	            let chartData1 = gaugeVal;
	            let chartData2 = 100 - gaugeVal;
	            if (amountDiff < 0) { chartData1 = 100 - gaugeVal; chartData2 = gaugeVal; }

	            window.gaugeChartInstance = new Chart(ctx, {
	                type: 'doughnut',
	                data: {
	                    datasets: [{
	                        data: [chartData1, chartData2],
	                        backgroundColor: [gradient, '#E8E8E8'],
	                        borderWidth: 0,
	                        cutout: '65%',
	                        rotation: -90,
	                        circumference: 180,
	                        borderRadius: 0
	                    }]
	                },
	                options: {
	                    responsive: false,
	                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
	                }
	            });
	        }
	        renderGaugeChart(); // ì°¨íŠ¸ ë Œë”ë§ í˜¸ì¶œ
            
	        // --- 2-3. AI í”¼ë“œë°± ë¡œì§ ì‹œì‘ (ë¸”ë¡ ì•ˆì— ì •í™•íˆ ìœ„ì¹˜) ---
	        // ... (ì´ì „ JavaScript ì½”ë“œ) ...

			// --- AI í”¼ë“œë°± ë¡œì§ ì‹œì‘ ---
			const aiTextElement = document.querySelector('.ai-text');
			if (aiTextElement) {
			    const latestElecFee = latestData.userElecFee || 0;
			    const previousElecFee = previousData.userElecFee || 0;
			
			    const latestWaterFee = latestData.userWaterFee || 0;
			    const previousWaterFee = previousData.userWaterFee || 0;
			
			    const elecDiff = latestElecFee - previousElecFee;
			    const waterDiff = latestWaterFee - previousWaterFee;
			
			    // ì ˆëŒ€ê°’ìœ¼ë¡œ ì¦ê°ë¥  ê³„ì‚° (ì¦ê°€/ê°ì†Œ í­ì´ í° ê²ƒì„ ì°¾ê¸° ìœ„í•¨)
			    let elecPercentDiffAbs = previousElecFee > 0 ? Math.abs((elecDiff / previousElecFee) * 100) : 0;
			    let waterPercentDiffAbs = previousWaterFee > 0 ? Math.abs((waterDiff / previousWaterFee) * 100) : 0;
			
			    let feedbackMessage = "";
			
			    // ì¦ê°ë¥ ì´ ë” ë†’ì€ í•­ëª©ì— ëŒ€í•´ í”¼ë“œë°±
			    if (elecPercentDiffAbs >= waterPercentDiffAbs) { // ì „ê¸°ë£Œ ì¦ê°ë¥ ì´ ë” ë†’ê±°ë‚˜ ê°™ì„ ë•Œ
			        if (elecDiff > 0) { // ì „ê¸°ë£Œ ì¦ê°€
			            feedbackMessage = `<strong>ì „ê¸° ì‚¬ìš©ëŸ‰ì´ ì €ë²ˆ ë‹¬ë³´ë‹¤ ${Math.round(elecPercentDiffAbs)}% ë§ë„¤ìš”.</strong> í˜¹ì‹œ ëƒ‰ë‚œë°© ê¸°ê¸° ì‚¬ìš©ì´ ëŠ˜ì—ˆì„ê¹Œìš”? â„ï¸`;
			        } else if (elecDiff < 0) { // ì „ê¸°ë£Œ ê°ì†Œ (ì ˆì•½)
			            feedbackMessage = `<strong>ì „ê¸° ì‚¬ìš©ëŸ‰ì´ ì €ë²ˆ ë‹¬ë³´ë‹¤ ${Math.round(elecPercentDiffAbs)}% ì¤„ì—ˆì–´ìš”!</strong> ì ˆì „ ìŠµê´€ ì•„ì£¼ ì¢‹ì•„ìš”! âœ¨`;
			        } else { // ì „ê¸°ë£Œ ë³€ë™ ì—†ìŒ
			            feedbackMessage = `ì „ê¸° ì‚¬ìš©ëŸ‰ì€ ì „ì›”ê³¼ ë¹„ìŠ·í•´ìš”. í˜„ìƒ ìœ ì§€ê°€ ì¤‘ìš”í•´ìš”! ğŸ’¡`;
			        }
			    } else { // ìˆ˜ë„ë£Œ ì¦ê°ë¥ ì´ ë” ë†’ì„ ë•Œ
			        if (waterDiff > 0) { // ìˆ˜ë„ë£Œ ì¦ê°€
			            feedbackMessage = `<strong>ìˆ˜ë„ ì‚¬ìš©ëŸ‰ë„ ì €ë²ˆ ë‹¬ë³´ë‹¤ ${Math.round(waterPercentDiffAbs)}% ì¦ê°€í–ˆì–´ìš”.</strong> í˜¹ì‹œ ëˆ„ìˆ˜ë‚˜ ë¶ˆí•„ìš”í•œ ë¬¼ ì‚¬ìš©ì€ ì—†ì—ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”. ğŸ’¦`;
			        } else if (waterDiff < 0) { // ìˆ˜ë„ë£Œ ê°ì†Œ (ì ˆì•½)
			            feedbackMessage = `<strong>ìˆ˜ë„ ì‚¬ìš©ëŸ‰ì´ ì €ë²ˆ ë‹¬ë³´ë‹¤ ${Math.round(waterPercentDiffAbs)}% ì¤„ì—ˆì–´ìš”!</strong> ë¬¼ ì ˆì•½ ìŠµê´€ ìµœê³ ì˜ˆìš”! ğŸ’§`;
			        } else { // ìˆ˜ë„ë£Œ ë³€ë™ ì—†ìŒ
			            feedbackMessage = `ìˆ˜ë„ ì‚¬ìš©ëŸ‰ì€ ì „ì›”ê³¼ ë¹„ìŠ·í•´ìš”. ë¬¼ ì ˆì•½ì€ í™˜ê²½ ë³´í˜¸ì˜ ì‹œì‘ì´ì£ ! ğŸŒ`;
			        }
			    }
			
			    // ë§Œì•½ ë‘˜ ë‹¤ ë³€ë™ì´ ê±°ì˜ ì—†ì„ ê²½ìš°ë¥¼ ìœ„í•œ ì¶”ê°€ ì²˜ë¦¬ (ì„ íƒ ì‚¬í•­)
			    if (elecPercentDiffAbs < 5 && waterPercentDiffAbs < 5 && elecDiff === 0 && waterDiff === 0) {
			        feedbackMessage = "ì´ë²ˆ ë‹¬ ì—ë„ˆì§€ ì‚¬ìš©ëŸ‰ì€ ì „ì›”ê³¼ í° ë³€ë™ì´ ì—†ë„¤ìš”. ì•ˆì •ì ì¸ ì†Œë¹„ìŠµê´€ì„ ìœ ì§€í•˜ê³  ìˆì–´ìš”! ğŸ‘";
			    }
			
			    aiTextElement.innerHTML = feedbackMessage.trim();
			} else {
			    console.warn("AI í”¼ë“œë°± ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: .ai-text");
			}
			// --- AI í”¼ë“œë°± ë¡œì§ ë ---
	        // --- AI í”¼ë“œë°± ë¡œì§ ë ---

	    } else { // rawData.length < 2 ì¼ ë•Œ (ë°ì´í„°ê°€ 0ê°œ ë˜ëŠ” 1ê°œì¼ ë•Œ)ì˜ ì²˜ë¦¬
	        // ì´ ë¸”ë¡ì€ ë°ì´í„°ê°€ 2ê°œ ë¯¸ë§Œì¼ ë•Œ ëª¨ë“  UIë¥¼ 'ë°ì´í„° ì—†ìŒ'ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

	        // ì²« ë²ˆì§¸ ì„¹ì…˜ (ì ˆì•½ ê¸ˆì•¡)
	        const summaryHighlightSpan = document.querySelector('.summary-left-wrapper .highlight');
	        const summaryLeftStrong = document.querySelector('.summary-left-wrapper strong');
	        const summaryRightP = document.querySelector('.summary-right-wrapper p');

	        if (summaryLeftStrong) { summaryLeftStrong.innerHTML = '<strong>ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ ì „ì›” ëŒ€ë¹„ ë¹„êµ ë¶ˆê°€</strong>'; }
	        if (summaryHighlightSpan) { summaryHighlightSpan.textContent = ''; } 
	        if (summaryRightP) { summaryRightP.textContent = 'ì•„ì‰½ì§€ë§Œ ë°ì´í„°ë¥¼ ë” ëª¨ì•„ë´ìš”!'; }
	        
	        // ë‘ ë²ˆì§¸ ì„¹ì…˜ (ì—ë„ˆì§€ ì†Œë¹„í˜„í™© - ê²Œì´ì§€ ì°¨íŠ¸)
	        document.getElementById('prevAmount').innerText = 'ë°ì´í„° ì—†ìŒ';
	        document.getElementById('thisAmount').innerText = 'ë°ì´í„° ì—†ìŒ';
	        document.getElementById('gaugeValueText').innerText = '-';
	        document.getElementById('monthlyDiff').innerHTML = 'ì „ì›” ëŒ€ë¹„ ë¹„êµ ë¶ˆê°€';

	        // AI í”¼ë“œë°± (ë°ì´í„° ë¶€ì¡±)
	        const aiTextElement = document.querySelector('.ai-text');
	        if (aiTextElement) {
	            aiTextElement.innerHTML = `<strong>ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ A.P.T í”¼ë“œë°±ì„ ì œê³µí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong>&nbsp;&nbsp;ê´€ë¦¬ë¹„ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!`;
	        }
	    }
	    
	    // --- (3) ì´ë²ˆ ë‹¬ ê°œë³„ ì „ê¸°ë£Œ, ìˆ˜ë„ë£Œ ë¡œì§ (rawData.length > 0) ---
	    // ì´ ë¸”ë¡ì€ rawData.lengthê°€ 1ê°œë§Œ ìˆì–´ë„ ìµœì‹  ë‹¬ ë°ì´í„°ëŠ” í‘œì‹œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
	    // ìœ„ì˜ `if (rawData && rawData.length >= 2)` ë¸”ë¡ê³¼ ë³„ê°œë¡œ ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
	    // ì¦‰, rawDataê°€ ìˆì„ ê²½ìš° (0ê°œë§Œ ì•„ë‹ˆë©´) ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ë„ë¡ í•©ë‹ˆë‹¤.
	    if (rawData && rawData.length > 0) { 
	        const latestData = rawData[rawData.length - 1]; // latestDataëŠ” ì—¬ê¸°ì„œ ë‹¤ì‹œ ì„ ì–¸ë©ë‹ˆë‹¤.

	        const currentElecFeeValue = latestData.userElecFee || 0;
	        const currentWaterFeeValue = latestData.userWaterFee || 0;

	        const currentTotalUsageFee = currentElecFeeValue + currentWaterFeeValue; 

	        document.getElementById('monthlyTotal').innerHTML = `ì´ë²ˆ ë‹¬ì—ëŠ” ì´ <span class="highlight-blue">${currentTotalUsageFee.toLocaleString('ko-KR')}ì›</span> ë‚˜ì™”ì–´ìš”.`;

	        document.getElementById('elecUsageAmount').innerText = currentElecFeeValue.toLocaleString('ko-KR') + 'ì›';
	        document.getElementById('waterUsageAmount').innerText = currentWaterFeeValue.toLocaleString('ko-KR') + 'ì›';

	        const total = currentElecFeeValue + currentWaterFeeValue;
	        const elecWidth = total > 0 ? (currentElecFeeValue / total) * 100 : 0;
	        const waterWidth = total > 0 ? (currentWaterFeeValue / total) * 100 : 0;

	        document.getElementById('barElectricity').style.width = `${elecWidth}%`; 
	        document.getElementById('barWater').style.width = `${waterWidth}%`; 
	        
	        // ì‚¬ìš©ëŸ‰ ë‹¨ìœ„ëŠ” VOì— ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ ë¹ˆ ê°’ìœ¼ë¡œ ë‘¡ë‹ˆë‹¤.
	        document.getElementById('elecUsageUnit').innerText = ``; 
	        document.getElementById('waterUsageUnit').innerText = ``; 

	    } else { // rawData.length == 0 ì¼ ë•Œ (ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ì„ ë•Œ)
	        document.getElementById('monthlyTotal').innerHTML = 'ì´ë²ˆ ë‹¬ ë°ì´í„° ì—†ìŒ';
	        document.getElementById('elecUsageAmount').innerText = '-ì›';
	        document.getElementById('waterUsageAmount').innerText = '-ì›';
	        document.getElementById('barElectricity').style.width = '50%'; 
	        document.getElementById('barWater').style.width = '50%'; 
	        document.getElementById('elecUsageUnit').innerText = ``; 
	        document.getElementById('waterUsageUnit').innerText = ``; 
	    }
	</script>

</body>

</html>