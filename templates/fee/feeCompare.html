<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê´€ë¦¬ë¹„ ë¹„êµ | A.P.T</title>

<!-- ì‚¬ì´ë“œë°” css -->
<link rel="stylesheet" href="/css/sidebar.css">

<!-- Pretendard(Font) -->
<link rel="stylesheet" th:href="@{/css/font.css}" />

<!-- Favicon -->
<link rel="icon" href="/icons/favicon.png" type="image/png">

<style>
body {
	margin: 0;
	background-color: #FDFDFD;
}

/* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
main {
	margin-left: 100px;
	padding: 40px 60px;
}

h1 {
	font-size: 38px;
	line-height: 1.5;
	color: #292929;
	margin-left: 350px;
	margin-bottom: 30px;
	padding-top: 80px;
}

.comparison-wrapper {
	display: flex;
	justify-content: center;
	gap: 100px;
}

.apartment-section {
	display: flex;
	flex-direction: column;
	align-items: center;
	width: 550px; /* í™•ì¥ë¨ */
}

.section-title {
	width: 100%;
	margin-bottom: 5px;
}

/* ê¸°ì¡´ section-title ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ */
.section-title {
    width: 100%;
    margin-bottom: 5px;
    /* ì´ë¯¸ì§€ ëŒ€ì‹  divë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì´ ì•„ë˜ì— ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤. */
}

/* ìƒˆë¡œìš´ ì•„íŒŒíŠ¸ ì¹´ë“œ divì˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
.apt-card {
    display: flex; /* í…ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ê¸° ìœ„í•´ flexbox ì‚¬ìš© */
    justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
    align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
    height: 60px; /* ë°°ë„ˆì˜ ë†’ì´ */
    border-radius: 20px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    font-size: 32px; /* ê¸€ì í¬ê¸° */
    font-weight: bold; /* ê¸€ì ë‘ê»ê²Œ */
    color: #FFFFFF; /* ê¸€ììƒ‰ (í°ìƒ‰) */
    text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ (ì„ íƒ ì‚¬í•­) */
}

/* ìš°ë¦¬ ì•„íŒŒíŠ¸ ì¹´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
.my-apt-card {
    background-color: #FF9C98; /* ìš°ë¦¬ ì•„íŒŒíŠ¸ ì´ë¯¸ì§€ì˜ ë°°ê²½ìƒ‰ê³¼ ìœ ì‚¬í•˜ê²Œ ì„¤ì • */
}

/* ë‹¤ë¥¸ ì•„íŒŒíŠ¸ ì¹´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
.other-apt-card {
    background-color: #FFBD7C; /* ë‹¤ë¥¸ ì•„íŒŒíŠ¸ ì´ë¯¸ì§€ì˜ ë°°ê²½ìƒ‰ê³¼ ìœ ì‚¬í•˜ê²Œ ì„¤ì • */
}

.apartment-box {
	width: 100%;
	min-height: 160px;
	border: 1px solid #ddd;
	border-radius: 12px;
	padding-right: 60px;
	padding-top: 20px;
	padding-left: 30px;
	/* padding: 20px; */
	background: #fff;
	box-sizing: border-box;
}

.input-group {
	display: flex;
	flex-direction: column;
	gap: 20px;
}

.input-row {
	display: flex;
	gap: 10px;
	align-items: center;
	color: #292929;
}

.input-row label {
	font-weight: 600;
	min-width: 60px;
}

.input-row select {
	padding: 10px;
	font-size: 1rem;
	border-radius: 6px;
	border: 1px solid #ccc;
	flex: 1;
}

.apt-list-header {
	width: 100%;
	margin-top: 30px;
	margin-bottom: 10px;
	display: flex;
	align-items: center;
}

.apt-list-box {
	width: 100%;
	height: 500px;
	border: 1px solid #ccc;
	border-radius: 10px;
	background-color: #fff;
	overflow-y: auto;
}

.compare-button-wrap {
	text-align: center;
	margin-top: 60px;
}

.compare-button-wrap button {
	background: none;
	border: none; /* â† ì™¸ê³½ì„  ì œê±° */
	padding: 0;
	cursor: pointer;
}

.compare-button-wrap img {
	width: 260px;
	cursor: pointer;
	display: block;
	margin-bottom: 30px;
}
/* apt-list-box ë‚´ ê°œë³„ ì•„íŒŒíŠ¸ í•­ëª© ìŠ¤íƒ€ì¼ */
.apt-item {
	padding: 15px 20px; /* ìƒí•˜ì¢Œìš° íŒ¨ë”© */
	border-bottom: 1px solid #eee; /* í•˜ë‹¨ ê²½ê³„ì„  */
	cursor: pointer; /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì»¤ì„œ ë³€ê²½ */
	transition: background-color 0.2s ease; /* ë¶€ë“œëŸ¬ìš´ ë°°ê²½ìƒ‰ ì „í™˜ íš¨ê³¼ */
	display: flex; /* ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ì„ ìœ„í•´ flexbox ì‚¬ìš© */
	justify-content: space-between; /* ë‚´ìš©ê³¼ ì„ íƒ ìƒíƒœ ì•„ì´ì½˜ì„ ì–‘ ëìœ¼ë¡œ ì •ë ¬ */
	align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
	color: #444; /* ê¸°ë³¸ ê¸€ììƒ‰ */
}

.apt-item:last-child {
	border-bottom: none; /* ë§ˆì§€ë§‰ í•­ëª©ì˜ í•˜ë‹¨ ê²½ê³„ì„  ì œê±° */
}

.apt-item:hover {
	background-color: #f9f9f9; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½ */
}

.apt-item strong {
	font-size: 1.1em; /* ì•„íŒŒíŠ¸ ì´ë¦„ ê¸€ì í¬ê¸° í‚¤ìš°ê¸° */
	color: #222; /* ì•„íŒŒíŠ¸ ì´ë¦„ ê¸€ììƒ‰ */
}

.apt-item span {
	font-size: 0.9em; /* ì£¼ì†Œ ê¸€ì í¬ê¸° */
	color: #777; /* ì£¼ì†Œ ê¸€ììƒ‰ */
	margin-top: 5px; /* ì£¼ì†Œì™€ ì•„íŒŒíŠ¸ ì´ë¦„ ì‚¬ì´ ê°„ê²© */
	display: block; /* ì£¼ì†Œë¥¼ ìƒˆ ì¤„ì— í‘œì‹œ */
}

/* ì„ íƒëœ ì•„íŒŒíŠ¸ í•­ëª©ì˜ ì„ íƒ í‘œì‹œ ì•„ì´ì½˜ */
.apt-item .selection-indicator {
	width: 20px;
	height: 20px;
	border-radius: 50%; /* ì›í˜• */
	background-color: #f0f0f0; /* ê¸°ë³¸ ë°°ê²½ìƒ‰ */
	border: 1px solid #ccc; /* í…Œë‘ë¦¬ */
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 0.8em;
	color: #fff;
}

.apt-item strong {
	font-size: 18px;
	font-weight: 500;
	color: #292929;
	display: block; /* ì¤„ë°”ê¿ˆ */
}

.apt-item span {
	font-size: 15px;
	color: #919191;
	margin-top: 5px;
	display: block; /* ì¤„ë°”ê¿ˆ */
}

/* ì•„íŒŒíŠ¸ ì„ íƒ ì‹œ ì„ íƒë¨ íš¨ê³¼ */
.apt-item.mySelected {
	background-color: #F8D7DA;
}

.apt-item.mySelected strong {
    font-weight: 700; /* ìš°ë¦¬ ì•„íŒŒíŠ¸ ì„ íƒ ì‹œ í…ìŠ¤íŠ¸ êµµê²Œ */
}

.apt-item.otherSelected {
	background-color: #FFF3CD;
}

.apt-item.otherSelected strong {
    font-weight: 700; /* ë‹¤ë¥¸ ì•„íŒŒíŠ¸ ì„ íƒ ì‹œ í…ìŠ¤íŠ¸ êµµê²Œ */
}

/* footer */
footer {
	background-color: #f2f2f2;
	padding: 15px 0;
	text-align: center;
	font-size: 14px;
	color: #666;
	width: 100%;
	flex-shrink: 0;
}
</style>
</head>
<body>
	<!-- ì‚¬ì´ë“œë°” í¬í•¨ -->
	<div th:replace="common/sidebar :: sidebar"></div>
	<!-- ì‚¬ì´ë“œë°” í¬í•¨ -->

	<h1>ë‹¤ë¥¸ ì•„íŒŒíŠ¸ì™€ ê´€ë¦¬ë¹„ ë¹„êµ</h1>

	<div class="comparison-wrapper">
		<div class="apartment-section">
			<div class="section-title apt-card my-apt-card">ìš°ë¦¬ ì•„íŒŒíŠ¸ ì„ íƒ</div>
			<div class="apartment-box">
				<div class="input-group">
					<div class="input-row">
						<!-- DB ì¡°íšŒí•´ì„œ ë³€í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ -->
						<label>ë°œìƒì›”</label>
						<select id="year-select">
							<option>ì—°ë„</option>
							<option th:each="year : ${yearList}" th:value="${year}" th:text="${year}"></option>
						</select>
						<select id="month-select"><option>ì›”</option></select>
					</div>
					<div class="input-row">
						<!-- DB ì¡°íšŒí•´ì„œ ë³€í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ -->
						<label>ì£¼ì†Œ</label>
						<select><option disabled selected>ëŒ€ì „ê´‘ì—­ì‹œ</option></select>
						<select class="district-select">
							<option>ìì¹˜êµ¬</option>
							<option th:each="dist : ${districtList}" th:value="${dist}" th:text="${dist}"></option>
						</select>
						<select class="dong-select">
							<option>ë™</option>
						</select>
					</div>
				</div>
			</div>
			<div class="apt-list-header">
				<img src="/icons/apartments.png" alt="ì•„íŒŒíŠ¸ ëª©ë¡" />
			</div>
			<div class="apt-list-box" id="home-apts"></div>
		</div>

		<div class="apartment-section">
			<div class="section-title apt-card other-apt-card">ë‹¤ë¥¸ ì•„íŒŒíŠ¸ ì„ íƒ</div>
			<div class="apartment-box">
				<div class="input-group">
					<div class="input-row">
						<!-- DB ì¡°íšŒí•´ì„œ ë³€í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ -->
						<label>ì£¼ì†Œ</label>
						<select><option disabled selected>ëŒ€ì „ê´‘ì—­ì‹œ</option></select>
						<select class="district-select">
							<option>ìì¹˜êµ¬</option>
							<option th:each="dist : ${districtList}" th:value="${dist}" th:text="${dist}"></option>
						</select>
						<select class="dong-select">
							<option>ë™</option>
						</select>
					</div>
				</div>
			</div>
			<div class="apt-list-header">
				<img src="/icons/apartments.png" alt="ì•„íŒŒíŠ¸ ëª©ë¡" />
			</div>
			<div class="apt-list-box" id="other-apts"></div>
		</div>
	</div>

	<!-- ë¹„êµ ë²„íŠ¼ ì˜ì—­ -->
	<div class="compare-button-wrap">
		<button onclick="openComparePopup()">
			<img src="/cards/ë¹„êµë²„íŠ¼.png" alt="ë¹„êµí•˜ê¸° ë²„íŠ¼" />
		</button>
	</div>
	
	<!-- ë¹„êµë¥¼ ìœ„í•´ ì €ì¥ -->
	<input type="hidden" id="myKaptCode" />
	<input type="hidden" id="otherKaptCode" />
	
	<!-- footer ì‹œì‘ -->
	<footer>
		<div>
			<p style="margin: 0;">Â© 2025 A.P.T. All rights reserved.</p>
			<p style="margin: 5px 0 0;">
				Made with <span class="computer-icon">ğŸ’»</span> by íŒ€ EF
			</p>
		</div>
	</footer>
	<!-- footer ë -->
	
	<script>
		// ì—°ë„ ì„ íƒ ì‹œ â†’ ì›” ëª©ë¡ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
		document.addEventListener("DOMContentLoaded", () => {
		  const yearSelect = document.getElementById("year-select");
		  const monthSelect = document.getElementById("month-select");
	
		  yearSelect.addEventListener("change", function () {
		    const selectedYear = this.value;
	
		    if (!selectedYear || selectedYear === "ì—°ë„") return;
	
		    fetch(`/getMonthList?year=${selectedYear}`)
		      .then(response => response.json())
		      .then(data => {
		        // ê¸°ì¡´ ì˜µì…˜ ì´ˆê¸°í™”
		        monthSelect.innerHTML = "";
	
		        // ìƒˆ ì˜µì…˜ ì±„ìš°ê¸°
		        data.forEach(month => {
		          const opt = document.createElement("option");
		          opt.value = month;
		          opt.textContent = month;
		          monthSelect.appendChild(opt);
		        });
		      })
		      .catch(error => {
		        console.error("ì›” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
		      });
		  });
		});
		
		// ìì¹˜êµ¬ ì„ íƒ â†’ ë™ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
		document.querySelectorAll(".district-select").forEach((select, idx) => {
		  select.addEventListener("change", function () {
		    const district = this.value;
		    const parentRow = this.closest(".input-row");
		    const dongSelect = parentRow ? parentRow.querySelector(".dong-select") : null;
		
		    if (!dongSelect || !district || district === "ìì¹˜êµ¬") return;
		
		    // âœ… ì•„íŒŒíŠ¸ ì¶œë ¥ìš© ì •ë³´
		    const resultBoxId = idx === 0 ? "home-apts" : "other-apts";
		    const hiddenInputId = idx === 0 ? "myKaptCode" : "otherKaptCode";
		    const selectedClass = idx === 0 ? "mySelected" : "otherSelected";
		
		    fetch(`/getDongList?district=${district}`)
		      .then(response => response.json())
		      .then(data => {
		        dongSelect.innerHTML = "<option disabled selected>ë™</option>"; // âœ… ì—¬ê¸°!
		        data.forEach(dong => {
		          const opt = document.createElement("option");
		          opt.value = dong;
		          opt.textContent = dong;
		          dongSelect.appendChild(opt);
		        });
		      })
		      .catch(err => console.error("ë™ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", err));
		  });
		});
		
		// ë™ ì„ íƒ ì‹œ ì•„íŒŒíŠ¸ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
		document.querySelectorAll(".dong-select").forEach((select, idx) => {
		  select.addEventListener("change", function () {
		    const dong = this.value;
		    if (!dong || dong === "ë™") return;
		
		    const resultBoxId = idx === 0 ? "home-apts" : "other-apts";
		    const hiddenInputId = idx === 0 ? "myKaptCode" : "otherKaptCode";
		    const selectedClass = idx === 0 ? "mySelected" : "otherSelected";
		
		    loadAptList(dong, resultBoxId, hiddenInputId, selectedClass);
		  });
		});
		
		// ì•„íŒŒíŠ¸ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
		function loadAptList(dong, resultBoxId, hiddenInputId, selectedClass) {
		  fetch(`/getAptList?dong=${dong}`)
		    .then(res => res.json())
		    .then(data => {
		      const resultBox = document.getElementById(resultBoxId);
		      resultBox.innerHTML = "";
		
		      data.forEach(apt => {
		    	  const div = document.createElement("div");
		    	  div.innerHTML = `
		    	    <div>
		    	      <strong>${apt.kaptName}</strong>
		    	      <span>${apt.kaptAddress}</span>
		    	    </div>
		    	  `;
		    	  div.classList.add("apt-item");

		    	  div.onclick = function () {
		    	    document.getElementById(hiddenInputId).value = apt.kaptCode;
		    	    document.querySelectorAll(`#${resultBoxId} .apt-item`).forEach(el => el.classList.remove(selectedClass));
		    	    this.classList.add(selectedClass);
		    	  };

		    	  resultBox.appendChild(div);
		    	});
		    });
		}
		
		// ë¹„êµ ë²„íŠ¼ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
		function openComparePopup() {
		  const year = document.querySelectorAll("select")[0].value;
		  const month = document.querySelectorAll("select")[1].value;
		  const myKaptCode = document.getElementById("myKaptCode").value;
		  const otherKaptCode = document.getElementById("otherKaptCode").value;
		
		  if (!myKaptCode || !otherKaptCode) {
		    alert("ìš°ë¦¬ì§‘ê³¼ ë‹¤ë¥¸ì§‘ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!");
		    return;
		  }
		
		  const compareType = "management";
		  const url = `feeComparePopup?myKaptCode=${myKaptCode}&otherKaptCode=${otherKaptCode}&myYear=${year}&myMonth=${month}&compareType=${compareType}`;
		  window.open(url, "comparePopup", "width=1000,height=750,resizable=yes,scrollbars=yes");
		}
	</script>
</body>
</html>
